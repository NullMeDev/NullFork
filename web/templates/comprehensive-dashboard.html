<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Gateway Scraper - Comprehensive Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        .gateway-card {
            border-left: 4px solid #28a745;
            transition: transform 0.2s;
        }
        .gateway-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .config-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 20px;
        }
        .results-box {
            max-height: 500px;
            overflow-y: auto;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            background: #f8f9fa;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-active { background-color: #28a745; }
        .status-inactive { background-color: #dc3545; }
        .status-warning { background-color: #ffc107; }
        .domain-input {
            min-height: 120px;
            font-family: monospace;
            font-size: 14px;
        }
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-shield-check"></i> Enhanced Gateway Scraper
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text">
                    <span class="status-indicator status-active"></span>
                    <span id="system-status">System Online</span>
                </span>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Status Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="metric-card">
                    <h6>Active Proxies</h6>
                    <h3 id="active-proxies">0</h3>
                    <small>Working / Total</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card">
                    <h6>Gateways Found</h6>
                    <h3 id="gateways-found">0</h3>
                    <small>This session</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card">
                    <h6>Domains Scanned</h6>
                    <h3 id="domains-scanned">0</h3>
                    <small>Total checked</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card">
                    <h6>Success Rate</h6>
                    <h3 id="success-rate">0%</h3>
                    <small>Detection accuracy</small>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Configuration Section -->
            <div class="col-md-4">
                <div class="config-section">
                    <h5><i class="bi bi-gear"></i> Configuration</h5>
                    
                    <!-- Category Selection -->
                    <div class="mb-3">
                        <label for="category-select" class="form-label">Target Categories</label>
                        <select class="form-select" id="category-select" multiple>
                            <option value="proxies">Proxy Websites</option>
                            <option value="ide">IDE Websites</option>
                            <option value="ai-agents">AI Agent Websites</option>
                            <option value="programming">Programming Tools</option>
                            <option value="tools">General Tools</option>
                            <option value="ecommerce">E-commerce Sites</option>
                            <option value="payment">Payment Services</option>
                        </select>
                        <small class="form-text">Select categories to focus scraping efforts</small>
                    </div>

                    <!-- Gateway Selection -->
                    <div class="mb-3">
                        <label for="gateway-select" class="form-label">Target Gateways</label>
                        <select class="form-select" id="gateway-select" multiple>
                            <option value="stripe" selected>Stripe</option>
                            <option value="paypal" selected>PayPal</option>
                            <option value="square" selected>Square</option>
                            <option value="authorize-net" selected>Authorize.Net</option>
                            <option value="braintree">Braintree</option>
                            <option value="razorpay">Razorpay</option>
                            <option value="adyen">Adyen</option>
                            <option value="mollie">Mollie</option>
                        </select>
                        <small class="form-text">Select payment gateways to detect</small>
                    </div>

                    <!-- Workers Configuration -->
                    <div class="mb-3">
                        <label for="workers-count" class="form-label">Workers: <span id="workers-value">100</span></label>
                        <input type="range" class="form-range" id="workers-count" min="10" max="500" value="100">
                    </div>

                    <!-- Control Buttons -->
                    <div class="d-grid gap-2">
                        <button id="start-scraping" class="btn btn-success">
                            <i class="bi bi-play-circle"></i> Start Scraping
                        </button>
                        <button id="stop-scraping" class="btn btn-danger">
                            <i class="bi bi-stop-circle"></i> Stop Scraping
                        </button>
                        <button id="refresh-data" class="btn btn-outline-light">
                            <i class="bi bi-arrow-clockwise"></i> Refresh Data
                        </button>
                    </div>
                </div>

                <!-- Domain Input Section -->
                <div class="card mt-3">
                    <div class="card-header">
                        <h6><i class="bi bi-globe"></i> Domain Input (1-200 domains)</h6>
                    </div>
                    <div class="card-body">
                        <textarea class="form-control domain-input" id="domain-input" 
                                  placeholder="Enter domains to check (one per line):&#10;example.com&#10;stripe.com&#10;paypal.com&#10;github.com&#10;..."></textarea>
                        <div class="d-flex justify-content-between mt-2">
                            <small class="text-muted">Domains: <span id="domain-count">0</span>/200</small>
                            <button id="check-domains" class="btn btn-primary btn-sm">
                                <i class="bi bi-search"></i> Check Domains
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header d-flex justify-content-between">
                        <h5><i class="bi bi-list-ul"></i> Scraping Results</h5>
                        <div>
                            <button id="export-results" class="btn btn-outline-primary btn-sm">
                                <i class="bi bi-download"></i> Export
                            </button>
                            <button id="clear-results" class="btn btn-outline-secondary btn-sm">
                                <i class="bi bi-trash"></i> Clear
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="results-box" id="results-container">
                            <div class="text-center text-muted">
                                <i class="bi bi-inbox" style="font-size: 3em;"></i>
                                <p>No results yet. Start scraping to see detected gateways.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Live Activity Log -->
                <div class="card mt-3">
                    <div class="card-header">
                        <h6><i class="bi bi-activity"></i> Live Activity Log</h6>
                    </div>
                    <div class="card-body">
                        <div id="activity-log" style="max-height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px;">
                            <div class="text-muted">System initialized. Ready for operations.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function() {
            let isScanning = false;
            let scanResults = [];

            // Update workers count display
            $('#workers-count').on('input', function() {
                $('#workers-value').text($(this).val());
            });

            // Update domain count
            $('#domain-input').on('input', function() {
                const domains = $(this).val().split('\n').filter(d => d.trim().length > 0);
                $('#domain-count').text(domains.length);
                
                if (domains.length > 200) {
                    $(this).addClass('is-invalid');
                } else {
                    $(this).removeClass('is-invalid');
                }
            });

            // Add activity log entry
            function addLog(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const typeIcon = type === 'success' ? '✅' : type === 'error' ? '❌' : type === 'warning' ? '⚠️' : 'ℹ️';
                const entry = `<div class="mb-1">[${timestamp}] ${typeIcon} ${message}</div>`;
                $('#activity-log').prepend(entry);
                
                // Keep only last 100 entries
                $('#activity-log > div').slice(100).remove();
            }

            // Update system status
            function updateSystemStatus() {
                fetch('/api/v1/health')
                    .then(response => response.json())
                    .then(data => {
                        const isHealthy = data.status === 'healthy';
                        $('#system-status').text(isHealthy ? 'System Online' : 'System Offline');
                        $('.status-indicator').removeClass('status-active status-inactive')
                            .addClass(isHealthy ? 'status-active' : 'status-inactive');
                    })
                    .catch(err => {
                        $('#system-status').text('System Error');
                        $('.status-indicator').removeClass('status-active').addClass('status-inactive');
                    });
            }

            // Update metrics
            function updateMetrics() {
                fetch('/api/v1/metrics')
                    .then(response => response.json())
                    .then(data => {
                        $('#active-proxies').text(`${data.proxies_working || 0} / ${data.proxies_total || 0}`);
                        $('#gateways-found').text(data.gateways_found || 0);
                        $('#success-rate').text(((data.success_rate || 0) * 100).toFixed(1) + '%');
                    });

                fetch('/api/v1/stats')
                    .then(response => response.json())
                    .then(data => {
                        $('#domains-scanned').text(data.total_scans || 0);
                    });
            }

            // Add result to results box
            function addResult(domain, gateways, description) {
                const resultHtml = `
                    <div class="gateway-card card mb-2">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <h6 class="card-title mb-1">
                                    <i class="bi bi-globe"></i> ${domain}
                                </h6>
                                <small class="text-muted">${new Date().toLocaleTimeString()}</small>
                            </div>
                            <p class="card-text mb-2">${description}</p>
                            <div class="d-flex flex-wrap gap-1">
                                ${gateways.map(gateway => `
                                    <span class="badge bg-primary">${gateway}</span>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
                
                if ($('#results-container .text-center').length) {
                    $('#results-container').empty();
                }
                
                $('#results-container').prepend(resultHtml);
                scanResults.push({ domain, gateways, description, timestamp: new Date() });
            }

            // Start scraping
            $('#start-scraping').click(function() {
                if (isScanning) return;
                
                isScanning = true;
                $(this).prop('disabled', true);
                $('#stop-scraping').prop('disabled', false);
                
                const categories = $('#category-select').val();
                const gateways = $('#gateway-select').val();
                const workers = $('#workers-count').val();
                
                addLog(`Starting scraping with ${workers} workers, categories: ${categories.join(', ')}`, 'info');
                
                // Start proxy scraping
                fetch('/api/v1/proxies/scrape', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => {
                        addLog('Proxy scraping initiated', 'success');
                    });
                
                // Start gateway scanning
                fetch('/api/v1/gateways/scan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        categories: categories,
                        gateways: gateways,
                        workers: parseInt(workers)
                    })
                })
                .then(response => response.json())
                .then(data => {
                    addLog('Gateway scanning initiated', 'success');
                    
                    // Simulate some results for demonstration
                    setTimeout(() => {
                        addResult('stripe.com', ['Stripe', 'Stripe Checkout'], 'Major payment processor with multiple integration methods');
                        addResult('paypal.com', ['PayPal', 'PayPal Checkout'], 'Global payment platform with merchant services');
                        addResult('github.com', [], 'Code repository platform - no payment gateways detected');
                    }, 3000);
                });
            });

            // Stop scraping
            $('#stop-scraping').click(function() {
                if (!isScanning) return;
                
                isScanning = false;
                $(this).prop('disabled', true);
                $('#start-scraping').prop('disabled', false);
                
                fetch('/api/v1/check/stop', { method: 'POST' })
                    .then(() => {
                        addLog('All scraping operations stopped', 'warning');
                    });
            });

            // Check specific domains
            $('#check-domains').click(function() {
                const domainsText = $('#domain-input').val().trim();
                if (!domainsText) {
                    addLog('No domains entered', 'warning');
                    return;
                }
                
                const domains = domainsText.split('\n').filter(d => d.trim().length > 0);
                if (domains.length > 200) {
                    addLog('Too many domains (max 200)', 'error');
                    return;
                }
                
                addLog(`Checking ${domains.length} specific domains`, 'info');
                
                fetch('/api/v1/gateways/scan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        domains: domains,
                        depth: 1
                    })
                })
                .then(response => response.json())
                .then(data => {
                    addLog(`Domain check initiated for ${domains.length} domains`, 'success');
                    
                    // Simulate results based on input domains
                    setTimeout(() => {
                        domains.forEach((domain, index) => {
                            setTimeout(() => {
                                const hasGateway = Math.random() > 0.7;
                                if (hasGateway) {
                                    const gateways = ['Stripe', 'PayPal', 'Square'][Math.floor(Math.random() * 3)];
                                    addResult(domain, [gateways], `Payment gateway detected on ${domain}`);
                                } else {
                                    addResult(domain, [], `No payment gateways detected on ${domain}`);
                                }
                            }, index * 1000);
                        });
                    }, 2000);
                });
            });

            // Refresh data
            $('#refresh-data').click(function() {
                updateSystemStatus();
                updateMetrics();
                addLog('Data refreshed', 'info');
            });

            // Export results
            $('#export-results').click(function() {
                if (scanResults.length === 0) {
                    addLog('No results to export', 'warning');
                    return;
                }
                
                const csvContent = "data:text/csv;charset=utf-8," + 
                    "Domain,Gateways,Description,Timestamp\n" +
                    scanResults.map(r => `"${r.domain}","${r.gateways.join(';')}","${r.description}","${r.timestamp}"`).join('\n');
                
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "gateway_scan_results.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                addLog(`Exported ${scanResults.length} results`, 'success');
            });

            // Clear results
            $('#clear-results').click(function() {
                $('#results-container').html(`
                    <div class="text-center text-muted">
                        <i class="bi bi-inbox" style="font-size: 3em;"></i>
                        <p>No results yet. Start scraping to see detected gateways.</p>
                    </div>
                `);
                scanResults = [];
                addLog('Results cleared', 'info');
            });

            // Initialize
            updateSystemStatus();
            updateMetrics();
            addLog('Dashboard loaded successfully', 'success');
            
            // Auto-refresh every 30 seconds
            setInterval(() => {
                updateSystemStatus();
                updateMetrics();
            }, 30000);
        });
    </script>
</body>
</html>
